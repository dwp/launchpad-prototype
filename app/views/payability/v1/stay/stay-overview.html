{% extends "layouts/payability.html" %}

{% block pageTitle %}
Impact of completed stays – {{ serviceName }} – GOV.UK Prototype Kit
{% endblock %}


{% set pageName = "Agent home" %}

{% set pipRates = {
  dailyLiving: {
    standard: { weekly: 73.90, daily: 10.56 },
    enhanced: { weekly: 110.40, daily: 15.77 }
  },
  mobility: {
    standard: { weekly: 29.20, daily: 4.17 },
    enhanced: { weekly: 77.05, daily: 11.01 }
  }
} %}

{% set dailyRate = pipRates.dailyLiving.enhanced.daily %}

<!-- SHARED "HOW THIS WORKS – Change in payment" MACRO-->
{% macro howThisWorks(totalDays, payableDays, nonPayableDays, overpayment, stayLabel) %}
<details class="govuk-details">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">How this was calculated</span>
  </summary>
  <div class="govuk-details__text">

    <p><strong>Rules in brief</strong></p>
    <ul class="govuk-list govuk-list--bullet">
      <li>PIP is payable for the first 28 days in hospital.</li>
      <li>From day 29, PIP is not payable.</li>
    </ul>

    <p><strong>{{ stayLabel }}</strong></p>
    <ul class="govuk-list govuk-list--bullet">
      <li>Total days in accommodation: {{ totalDays }}</li>
      <li>Days PIP is payable on: {{ payableDays }}</li>
      <li>Non‑payable days: {{ nonPayableDays }}</li>
    </ul>

    <p>
      <strong>Overpayment calculation</strong><br>
      {{ nonPayableDays }} non‑payable days × £{{ dailyRate }} per day =
      <strong>£{{ overpayment }}</strong>
    </p>

    <p class="govuk-hint">
      Rate used: PIP Daily Living – Enhanced (£{{ dailyRate }} per day, effective from 4 April 2025)
    </p>

  </div>
</details>
{% endmacro %}


<!-- SHARED "HOW THIS WORKS – Linked period" MACRO -->
{% macro howThisWorksLinked(totalDays, payableDays, nonPayableDays, overpayment, stayLabel) %}
<details class="govuk-details">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">How this was calculated</span>
  </summary>
  <div class="govuk-details__text">

    <p><strong>Rules in brief</strong></p>
    <ul class="govuk-list govuk-list--bullet">
      <li>Hospital stays separated by 28 days or less are <strong>linked</strong> and counted together.</li>
      <li>PIP becomes payable again only after 28 days out of hospital.</li>
    </ul>

    <p><strong>{{ stayLabel }}</strong></p>
    <ul class="govuk-list govuk-list--bullet">
      <li>Total days in accommodation: {{ totalDays }}</li>
      <li>Days PIP is payable on: {{ payableDays }}</li>
      <li>Non‑payable days: {{ nonPayableDays }}</li>
    </ul>

    <p>
      <strong>Overpayment calculation</strong><br>
      {{ nonPayableDays }} non‑payable days × £{{ dailyRate }} per day =
      <strong>£{{ overpayment }}</strong>
    </p>

    <p class="govuk-hint">
      Rate used: PIP Daily Living – Enhanced (£{{ dailyRate }} per day, effective from 4 April 2025)
    </p>

  </div>
</details>
{% endmacro %}


<!-- SHARED "PAYMENT PERIODS AFFECTED" MACRO -->
{% macro paymentPeriodsAffected(periodLabel, nonPayableDays, overpayment) %}
  <p>{{ periodLabel }}:</p>
  <ul class="govuk-list govuk-list--bullet">
    <li>Non‑payable days: {{ nonPayableDays }}</li>
    <li>Overpaid to claimant: £{{ overpayment }}</li>
  </ul>
{% endmacro %}
{% block beforeContent %}
{{ govukBackLink({
        text: "Back",
        href: "javascript:history.back()"
        }) }}
{% endblock %}
{% block content %}


<div class="govuk-grid-row">

{% if data['funding-scenario'] == 'Health Authority' or data['funding-scenario'] == 'Not known' %}
  <form class="form" action="notes" method="post">
{% else %}
  <form class="form" action="/payability/v1/person-record/temporary-accomodation" method="post">
{% endif %}

<div class="govuk-grid-column-three-quarters">

  <h1 class="govuk-heading-l">Completed stay outcome</h1>

  <!-- stay 1-->
  <h2 class="govuk-heading-m">Stay period: 6 February – 9 March</h2>

  {% set totalDays = 32 %}
  {% set payableDays = 28 %}
  {% set nonPayableDays = 4 %}
  {% set overpayment = nonPayableDays * dailyRate %}

  {{ govukSummaryList({
    card: {
      title: { text: "Royal Victoria Infirmary" },
      actions: {
        items: [
          {
            href: "type",
            text: "Edit stay",
            attributes: { id: "edit-stay-link" },
            visuallyHiddenText: "of Morgan Hospital"
          },
          {
            href: "delete",
            text: "Delete stay",
            visuallyHiddenText: "of Morgan Hospital"
          }
        ]
      }
    },
    rows: [
      { key: { text: "Stay type" }, value: { html: "Hospital" } },
      {
        key: { text: "Funded by" },
        value: { html: "NHS" }
      },
      {
        key: { text: "Accomodation address" },
        value: { html: "72 Guild Street<br>London<br>SE23 6FH" }
      },
      {
        key: { text: "Accomodation contact" },
        value: { html: "Sarah Philips<br>sarah.philips@example.com" }
      },
      { key: { text: "Days in accommodation" }, value: { html: totalDays } },
      { key: { text: "Non‑payable days" }, value: { html: nonPayableDays } },
      {
        key: { text: "Payment periods affected" },
        value: {
          html:
          '
          <p>
            <a href="daily-breakdown" class="govuk-link">5 March 2026 – 4 April 2026</a>:
          </p>
          <ul class="govuk-list govuk-list--bullet">
            <li>Non‑payable days: ' + nonPayableDays + '</li>
            <li>Overpaid to claimant: £' + (overpayment | round(2)) + '</li>
          </ul>'
        }
      },
      {
        key: { text: "Total amount overpaid to the claimant" },
        value: {
          html: "£" + overpayment + "<br><br>" +
            howThisWorks(
              totalDays,
              payableDays,
              nonPayableDays,
              overpayment,
              "This stay"
            )
        }
      }
    ]
  }) }}

  <h4 class="govuk-heading-s">This is a linked stay </h4>
  <p> This stay links to: </p>
  <ul class="govuk-list govuk-list--bullet">
    <li><a href="">January 15 - January 20
    </a></li>
    <li><a href="">January 21 - January 31</a></li>
  </ul>

</div>
</div>



{% endblock %}